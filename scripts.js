const API_KEY = 'sk-proj-IQUsjNTJ8DKc8HESSOCeT3BlbkFJJPEraM0ScBZQkSXy05Gu'; // Reemplaza con tu API Key de OpenAI
const RATE_LIMIT_MS = 2000; // Tiempo mínimo entre solicitudes en milisegundos (2 segundos)
let lastRequestTime = 0;

const options = {
    option1: "Proceso de admisión de alumnos regulares en la universidad: El artículo establece los requisitos para la admisión de estudiantes regulares: Poseer diploma de bachiller o equivalente. Pagar derechos de inscripción. Inscribirse en la Oficina de Admisiones y Registro. Obtener el puntaje requerido en las Pruebas de Estado. Se mencionan categorías especiales de admisión: Beneficiarios del Decreto 644/2001 (altos puntajes en examen de Estado) Bachilleres de zonas apartadas o con problemas de orden público Miembros de comunidades indígenas y negras Bachilleres de departamentos sin instituciones de educación superior Isleños o Raizales de San Andrés, Providencia y Santa Catalina Víctimas de violencia (Ley 1448/2011) Para estas categorías se establecen requisitos adicionales, cupos especiales y, en algunos casos, exención de matrícula. Se especifica que: No se devolverán derechos de inscripción El Consejo Superior puede establecer otras formas de admisión Las pruebas SABER 11 deben tener menos de 5 años de antigüedad Programas nocturnos y a distancia están exentos de algunos requisitos",
    option2: "Requisitos de matrícula para estudiantes nuevos: Requisitos generales: Certificado de buena salud Fotocopia del diploma de bachiller Dos fotografías Fotocopia de documento de identidad Certificación de situación militar Recibo de pago de matrícula Requisitos adicionales para estudiantes de Ciencias de la Salud: Esquema de vacunación completo (Hepatitis B, fiebre amarilla, DPT, Triple Viral) Certificación de afiliación al Sistema de Seguridad Social en Salud Examen de serología semestral Seguro contra riesgos biológicos y accidentes Prueba de títulos de anticuerpos contra Hepatitis B Requisitos para estudiantes de formación propedéutica: Pago de derechos de admisión Fotocopia de documento de identidad Aprobación de educación básica secundaria o certificado del SENA con experiencia Historial académico del último grado cursado Cumplimiento de leyes colombianas",
    option3: "Estímulos y Reconocimientos Académicos Motivos para otorgar estímulos: Rendimiento académico sobresaliente Participación destacada en actividades culturales, sociales, deportivas, artísticas o de extensión comunitaria Tipos de incentivos: a) Delegaciones y comisiones b) Publicaciones de trabajos académicos c) Beca-trabajo, monitorias y asistente de docencia e investigación d) Exoneración del pago de matrícula e) Matrícula de Honor f) Trabajos de grado Meritorios o Laureados g) Grado de Honor h) Becas de Posgrado i) Distinciones universitarias Requisitos generales para obtener incentivos: Ser estudiante regular de la Universidad No tener sanciones académicas, disciplinarias o de otro tipo Cumplir los requisitos específicos para cada distinción Delegaciones y comisiones: Representan a la institución en eventos académicos, científicos, culturales, deportivos, etc. Criterios de selección: desempeño relevante y inscripción oportuna Aprobadas por el Consejo Académico o según el Estatuto de Bienestar Universitario Publicaciones académicas: Recomendadas por el Consejo de Facultad al Consejo Académico Becas de trabajo y monitorías: Reguladas por el Estatuto de Bienestar Universitario Matrícula de Honor: Para estudiantes de modalidad presencial Promedio ponderado acumulado ≥ 4.0 Exención de pago de matrícula para el siguiente período Distinción Francisco de Paula Santander: Medalla de oro: Grado de Honor Medalla de plata: Todo el pensum con matrícula de honor Placa de Reconocimiento: 80% del pensum con matrícula de honor Becas por Matrícula de Honor en sistema de Créditos Académicos: Hasta 10% de estudiantes por plan de estudios Promedio ponderado acumulado ≥ 3.75 Deben aprobar todas las asignaturas del semestre Ampliación para estudiantes en movilidad: Promedio dentro del 10% de los mejores del programa Deben aprobar todo el plan académico de movilidad Trabajos de Grado Meritorios o Laureados: Otorgados por el Consejo Académico Grado de Honor: Para estudiantes que cursaron toda la carrera en la Universidad Promedio ponderado acumulado ≥ 4.5 Se menciona en el diploma Registro de estímulos: Se anotan en la hoja de vida del estudiante Se indican en los certificados expedidos Se publican en medios escritos de la Universidad",
    option4: "Cursos de Vacaciones, Créditos Opcionales y Actividades Complementarias Cursos de Vacaciones: Definición y condiciones generales: Son cursos programados durante el período de vacaciones entre semestres académicos. Solo se pueden realizar cuando hay normalidad académica (semestres coinciden con el calendario). Un estudiante puede matricular solo una asignatura por período de vacaciones. Tipos de asignaturas y docentes: Principalmente para asignaturas teóricas de los planes de estudio. Asignaturas teórico-prácticas pueden incluirse con aprobación del Consejo de Facultad. Limitado a asignaturas con hasta 5 horas semanales de intensidad. Docentes deben ser de planta, ocasionales o catedráticos de la Universidad. Características académicas: Misma intensidad horaria que los cursos ordinarios. Mismo sistema de evaluación que los cursos regulares. Los resultados se integran al semestre académico inmediatamente anterior. Matrícula y cancelación: Estudiantes deben matricularse con el Director del plan de estudios. Cancelación sin calificaciones posible en las primeras dos semanas. Cancelación posterior solo por fuerza mayor, con aprobación del Director. Flexibilidad entre sedes: Estudiantes pueden tomar cursos en la sede Central o seccional Ocaña. Normativa y Costos: Programación y responsabilidades: Cursos programados por el Director del Plan de Estudios. Director responsable de la implementación académico-administrativa. Costos y tarifas: Fijados por el Consejo Superior Universitario. Varían según el número de estudiantes: 0.10 Salario Mínimo por hora para 15 estudiantes 0.13 Salario Mínimo por hora para 10-14 estudiantes 0.30 Salario Mínimo por hora para 5-9 estudiantes Cuota de inscripción: 0.05 SMMLV, deducible del costo total y no reembolsable. Excepciones: Cursos no realizados durante el semestre regular por fuerza mayor pueden programarse sin costo adicional. En estos casos, pueden incluirse asignaturas teóricas, prácticas y teórico-prácticas. Créditos Opcionales: Definición y valor: Otorgados por actividades culturales o deportivas. Generalmente 2 créditos por actividad semestral. 3 créditos para grupos que representan a la institución a nivel municipal, departamental o nacional. Características académicas: Evaluados como materias prácticas. Se incluyen en el promedio académico del estudiante. No afectan prerrequisitos ni forman parte de la malla curricular oficial. Administración: Coordinados por la División de Cultura, Recreación y Deportes. Supervisados por la Vicerrectoría de Bienestar Universitario. Informe semestral al Consejo Académico sobre su desarrollo. Este sistema integral de cursos de vacaciones y créditos opcionales ofrece a los estudiantes: Flexibilidad para avanzar en sus estudios durante períodos vacacionales. Oportunidad de recuperar o adelantar asignaturas. Reconocimiento académico por actividades extracurriculares. Posibilidad de enriquecer su formación más allá del plan de estudios estándar.",
    option5: "Trabajo de Grado: Definiciones y Modalidades Definición y objetivos del trabajo de grado: Es un componente esencial del plan de estudios Busca demostrar la capacidad investigativa, creatividad y disciplina del estudiante Sirve como instrumento de extensión a la comunidad Genera conocimiento y facilita la participación en la solución de problemas comunitarios Promueve la autonomía en el desarrollo de trabajos científicos y profesionales Modalidades detalladas: a) Proyecto de Investigación: Monografía: Trato sistemático de un tema específico, puede ser descriptiva o explicativa Trabajo de Investigación: Actividad intelectual para construir conocimientos Sistematización del conocimiento: Organización de saberes de forma novedosa y didáctica b) Proyecto de Extensión: Trabajo social: Desarrollo de programas para mejorar la calidad de vida de una comunidad Consultoría: Elaboración de proyectos de inversión, infraestructura, etc., en colaboración con la universidad Pasantía: Rotación en una institución bajo la dirección de un experto Trabajo dirigido: Desarrollo de un proyecto específico bajo supervisión profesional c) Alternativas: Cursos de Profundización Académica: Cursos adicionales al pensum para complementar la formación Exámenes Preparatorios: Pruebas sobre áreas seleccionadas por el Comité Curricular Requisitos y procedimientos: Presentación de anteproyecto ante el Comité Curricular para todas las modalidades Duración mínima de un semestre y 300 horas para ciertas modalidades Informes mensuales de avance y certificación de tiempo dedicado Para cursos de profundización: mínimo 300 horas y certificación de notas Exámenes preparatorios: requieren haber aprobado el 100% de los créditos del plan de estudios Sistema de evaluación: Varía según la modalidad elegida Exámenes preparatorios: calificación de 0.0 a 5.0, aprobatoria desde 4.0 Posibilidad de calificación meritoria (4.0-4.49) o laureada (5.0) en exámenes preparatorios Oportunidad de repetir exámenes preparatorios bajo ciertas condiciones Para otras modalidades, la calificación se rige por el Estatuto Estudiantil Aspectos administrativos y legales: Costos del trabajo de grado a cargo del estudiante Posibilidad de convenios interinstitucionales para proyectos externos Reglamentación específica por facultad y plan de estudios Creación de bancos de proyectos en departamentos académicos y Vicerrectoría de Investigación y Extensión Delegación al Consejo Académico para aprobar reglamentaciones específicas Etapas del proyecto de grado: Presentación del anteproyecto o plan de trabajo Desarrollo de la investigación o ejecución del proyecto Sustentación o verificación de la realización del proyecto Presentación de informe final avalado por el director Consideraciones especiales: Reglamentación específica para exámenes preparatorios en Derecho (sede central y seccional Ocaña) Posibilidad de obviar el trabajo de grado en algunos planes de estudio, según decisión del Consejo Académico Incorporación de trabajos de grado como componente básico del quehacer universitario Flexibilidad y adaptabilidad: Opciones variadas para adaptarse a diferentes intereses y capacidades de los estudiantes Posibilidad de elegir entre investigación, extensión o profundización académica Reconocimiento de actividades prácticas como pasantías y consultorías",
    option6: "Procedimientos del trabajo de grado. Inicio y requisitos: Estudiantes pueden iniciar el trabajo de grado al aprobar el 60% de los créditos del plan de estudios Trabajos interdisciplinarios requieren aprobación de todos los Comités Curriculares involucrados Todo trabajo debe tener un Director profesional del área, que puede o no estar vinculado a la Universidad Matrícula y costos: Matrícula obligatoria en el semestre de presentación y aprobación del trabajo Si no se sustenta en ese semestre, debe matricularse nuevamente sin recargo por matrícula extraordinaria Estudiantes que solo desarrollan el proyecto pagan derechos pecuniarios reducidos Estudiantes de Educación a Distancia pagan el 20% del valor de la matrícula Pago completo requerido para evaluación y sustentación final Funciones del Comité Curricular: Aprobar o rechazar anteproyectos o planes de trabajo Aceptar o no al Director y asesores del trabajo Nombrar el jurado calificador Emitir concepto sobre calificaciones Meritoria o Laureada Elaborar normativas internas para proyectos de grado, sujetas a aprobación superior Sustentación y evaluación: Examen público con presencia obligatoria de jurados y director Estudiantes deben tener un promedio ponderado mínimo de 3.1 para sustentar Calificación de 0.0 a 5.0, aprobatoria desde 3.0 Criterios de evaluación incluyen calidad académica, relevancia, contribución a objetivos institucionales y sustentación oral Calificación individual para cada participante en trabajos grupales Escala de calificaciones: Aprobado: 3.0 - 4.49 Meritoria: 4.5 - 4.99 Laureada: 5.0 Trabajos con nota entre 2.0 y 2.99 pueden corregirse y sustentarse nuevamente Trabajos con nota inferior a 2.0 son reprobados y requieren nuevo anteproyecto Impacto en el promedio académico: Aprobado: incrementa 0.1 en el promedio ponderado acumulado Meritoria: incrementa 0.2 Laureada: incrementa 0.3 Plazos y consideraciones especiales: 180 días calendario para sustentación individual en casos de fuerza mayor Posibilidad de sustentación individual en trabajos grupales por fuerza mayor comprobada Propiedad intelectual y sanciones: Los trabajos de grado son propiedad intelectual de la Universidad Fraude comprobado se sanciona según normativa universitaria, sin perjuicio de acciones legales Funciones del Jurado Calificador: Analizar el trabajo de grado Asistir a la sustentación y evaluar la presentación Evaluar, calificar y producir un acta de sustentación con la nota definitiva",
    option7: "Otorgamiento del Título Otorgamiento de Títulos (Artículo 160): La universidad otorga títulos en sesiones solemnes según el calendario académico. El Consejo Académico puede programar sesiones especiales por razones excepcionales. Se permiten grados individuales por causas de fuerza mayor, previa autorización del Consejo Académico. Plazos para Trabajos de Grado (Artículo 161): Los estudiantes tienen 2 años después de terminar las asignaturas para presentar el trabajo de grado. Si no se cumple este plazo, deben solicitar una prórroga al Consejo de Facultad, justificando los motivos. El Consejo de Facultad determina la duración de la nueva prórroga. El Comité Curricular establece los requisitos para la prórroga según el Plan de Estudios vigente. Graduación Tardía (Artículo 162): Si un estudiante no se gradúa en el año siguiente a la terminación de su Plan de Estudios, debe solicitar al Consejo Académico que fije la fecha de graduación. Entrega de Trabajos de Grado (Artículo 163): Los estudiantes deben entregar una copia digital (PDF) del trabajo de grado aprobado a la Biblioteca. Se permite el envío por correo electrónico para estudiantes fuera de la ciudad. El Consejo Académico define la metodología y lineamientos de presentación de los trabajos. Costos Asociados (Artículo 164): Todos los gastos relacionados con la preparación, desarrollo, presentación y sustentación del trabajo de grado son responsabilidad del estudiante. Disposiciones Especiales: El Consejo Académico puede establecer nuevos criterios académicos según las necesidades de los Planes de Estudio (Artículo 165). Se permite a los estudiantes cursar dos programas académicos simultáneamente (Artículo 166). Se menciona que habrá reglamentaciones específicas para estudios preuniversitarios, posgrados, educación a distancia y cursos de extensión (Artículo 167). Aspectos no previstos en el acuerdo serán objeto de reglamentación específica (Artículo 168). Modificaciones al Estatuto (Artículo 169): Las reformas requieren aprobación del Consejo Superior Universitario. El trámite y discusión debe hacerse en dos sesiones separadas. Disposiciones Finales: Para lo no previsto, la universidad se acoge a las normas legales e institucionales pertinentes (Artículo 170). El acuerdo entra en vigencia inmediatamente y deroga normas anteriores, incluyendo el Acuerdo 065 de 1996 (Artículo 171)",
    option8: "Clasificación y Normativa de Exámenes Clasificación de Exámenes (Artículo 98): Se enumeran 10 tipos: Previos, Finales, De Habilitación, Supletorios, Validación, Opcionales, De Concurso, De Sustentación de Trabajos, Sustentación de Proyectos Integrales, y De Sustentación de Tesis o Trabajos de Grado. El Consejo Superior Universitario fija los derechos para exámenes opcionales, de habilitación y de validación. Los exámenes pueden ser escritos, orales, prácticos o una combinación de estos (Artículo 99). Exámenes Previos y Finales: Exámenes Previos (Artículo 100): Al menos dos por semestre, antes del examen final. Exámenes Finales (Artículo 101): Al terminar el período académico en asignaturas teóricas y teórico-prácticas. Exámenes orales requieren un jurado de dos profesores. Se permite solicitar un segundo calificador para los exámenes finales dentro de las 48 horas siguientes a la publicación de la calificación. Exámenes de Habilitación (Artículo 102): Para estudiantes con nota final entre 2.0 y 2.9 en asignaturas teóricas o teórico-prácticas. Deben ser escritos y presentarse en fechas estipuladas. No hay segunda habilitación. Las materias prácticas no son habilitables. Pueden tener un segundo calificador bajo ciertas condiciones. Exámenes Supletorios (Artículos 103-105): Se presentan en fecha distinta a la oficial por causa justificada. La solicitud debe hacerse dentro de los 3 días siguientes a la fecha original. Solo aplican para exámenes previos o finales. El profesor de la asignatura autoriza los supletorios de previas, y el Director del Plan de Estudios los de finales. Asistencia y Evaluación (Artículo 106): Se requiere 80% de asistencia en clases presenciales para asignaturas teórico-prácticas y prácticas. El incumplimiento puede resultar en la pérdida del derecho a la tercera evaluación o la pérdida de la materia. Exámenes de Validación (Artículos 107-112): Para reconocer cursos de otras universidades o comprobar idoneidad. Limitados a dos asignaturas por semestre académico. Requieren autorización del Consejo de Facultad. No aplican para materias reprobadas o prácticas. Deben ser orales y escritos, con nota mínima de 4.0 para aprobar. Son evaluados por un jurado de dos profesores. Exámenes Opcionales (Artículos 113-114): Para mejorar calificaciones en materias ya aprobadas. Se programan junto con las habilitaciones. La nota final se calcula según reglas específicas dependiendo de si se aprueba o no el examen opcional. Procedimientos y Plazos para Calificaciones: Exámenes previos: Resultados en 8 días (Artículo 115). Revisión de calificaciones: 5 días hábiles para solicitar al profesor (Artículo 116). Exámenes finales: Resultados en 3 días hábiles, con 24 horas adicionales para entrega oficial (Artículo 117)."
};

let selectedContent = '';

function selectOption(option) {
    selectedContent = options[option];
    document.getElementById('user-input').disabled = false;
    document.getElementById('send-btn').disabled = false;
    
    // Remover clase seleccionada de todas las opciones
    document.querySelectorAll('.option-btn').forEach(btn => btn.classList.remove('selected-option'));
    
    // Añadir clase seleccionada al botón clicado
    document.querySelector(`[onclick="selectOption('${option}')"]`).classList.add('selected-option');
}

document.getElementById('send-btn').addEventListener('click', async () => {
    const userInput = document.getElementById('user-input').value;
    if (!userInput) return;

    addMessage(userInput, 'user-message');
    document.getElementById('user-input').value = '';

    const currentTime = Date.now();
    if (currentTime - lastRequestTime < RATE_LIMIT_MS) {
        addMessage('Por favor, espera antes de enviar otro mensaje.', 'bot-message');
        return;
    }

    lastRequestTime = currentTime;

    try {
        const response = await fetch('https://api.openai.com/v1/chat/completions', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${API_KEY}`
            },
            body: JSON.stringify({
                model: "gpt-3.5-turbo", // Utiliza el modelo adecuado
                messages: [
                    { role: "system", content: "Eres un asistente que proporciona respuestas basadas en la siguiente información seleccionada del estatuto estudiantil de la Universidad Francisco de Paula Santander:" },
                    { role: "system", content: selectedContent },
                    { role: "user", content: userInput }
                ],
                max_tokens: 150
            })
        });

        //console.log(selectedContent)

        if (response.status === 429) {
            addMessage('Se ha superado el límite de solicitudes. Por favor, intenta nuevamente más tarde.', 'bot-message');
            return;
        }

        if (!response.ok) {
            addMessage('Error al comunicarse con la API', 'bot-message');
            return;
        }

        const data = await response.json();
        const botReply = data.choices[0].message.content.trim();

        addMessage(botReply, 'bot-message');
        
        // Volver a mostrar las opciones y deshabilitar el input
        document.getElementById('options-container').style.display = 'flex';
        document.getElementById('user-input').disabled = true;
        document.getElementById('send-btn').disabled = true;

        // Remover la selección visual de la opción
        document.querySelectorAll('.option-btn').forEach(btn => btn.classList.remove('selected-option'));
    } catch (error) {
        addMessage('Error al comunicarse con la API', 'bot-message');
    }
});

function addMessage(message, className) {
    const chatContent = document.getElementById('chat-content');
    const messageElement = document.createElement('div');
    messageElement.classList.add('message', className);
    messageElement.textContent = message;
    chatContent.appendChild(messageElement);
    chatContent.scrollTop = chatContent.scrollHeight;
}
